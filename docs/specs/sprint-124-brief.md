# Sprint 124: Error Boundaries & Loading States (Extended) â€” Implementation Brief

> **Generated:** 2026-02-06
> **Generated By:** Roadmap Planning Session (Phase 18: Production Hardening)
> **Status:** Ready for Implementation (skip plan mode)
> **Priority:** P1 | **Hours:** 8-10

---

## Overview

Extended error resilience pass covering client portal, sub portal, field portal, and any remaining dashboard sections not covered in Sprint 117. Also adds graceful offline degradation and React strict mode cleanup.

---

## Scope

### Portal Error Boundaries
- Client portal: All pages get SectionErrorBoundary wraps
- Sub portal: All pages get SectionErrorBoundary wraps
- Field portal: All pages get SectionErrorBoundary wraps

### useEffect Cleanup Audit
- Audit all useEffect hooks for missing cleanup functions
- Fix memory leaks from unsubscribed listeners
- Verify React strict mode compatibility (double-mount safety)

### Offline Degradation
- Show cached data when offline with "offline" banner
- Queue mutations for when connection returns
- Graceful fallback for all real-time subscriptions

---

## Files to Modify

### Portal Pages (Error Boundaries)
| # | Route | File |
|---|-------|------|
| 1 | /client | app/client/page.tsx |
| 2 | /client/invoices | app/client/invoices/page.tsx |
| 3 | /client/projects | app/client/projects/page.tsx |
| 4 | /sub | app/sub/page.tsx |
| 5 | /sub/bids | app/sub/bids/page.tsx |
| 6 | /sub/invoices | app/sub/invoices/page.tsx |
| 7 | /field | app/field/page.tsx |
| 8 | /field/daily-log | app/field/daily-log/page.tsx |
| 9 | /field/issues | app/field/issues/page.tsx |
| 10 | /field/safety | app/field/safety/page.tsx |

### Hook Cleanup (All hooks with subscriptions)
| # | File | Fix |
|---|------|-----|
| 1-85 | lib/hooks/use*.ts | Ensure unsubscribe in useEffect cleanup |

---

## Parallel Work Plan

### Batch 1 (All Independent)
| Agent | Task | Est. Tokens |
|-------|------|-------------|
| Agent 1 | Error boundaries on client portal pages | ~15k |
| Agent 2 | Error boundaries on sub + field portal pages | ~15k |
| Agent 3 | useEffect cleanup audit (hooks A-M) | ~25k |
| Agent 4 | useEffect cleanup audit (hooks N-Z) | ~25k |

### Batch 2
| Agent | Task | Est. Tokens |
|-------|------|-------------|
| Agent 5 | Offline degradation improvements | ~20k |

---

## Acceptance Criteria

- [ ] All portal pages have SectionErrorBoundary wraps
- [ ] All useEffect hooks have proper cleanup (no memory leaks)
- [ ] App passes React strict mode (no double-mount issues)
- [ ] Offline banner shows when disconnected
- [ ] npx tsc --noEmit passes
- [ ] All tests pass

---

## Estimated Token Budget: ~100k
