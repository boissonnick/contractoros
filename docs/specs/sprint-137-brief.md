# Sprint 137: Client Selection Board & Allowance Tracking — Implementation Brief

> **Generated:** 2026-02-06
> **Generated By:** Roadmap Planning Session (Phase 22: Client Experience)
> **Status:** Ready for Implementation (skip plan mode)
> **Priority:** P0 | **Hours:** 8-10

---

## Overview

The #1 feature residential GC clients ask for: picking finishes, fixtures, and materials. Build an enhanced selection board with allowance tracking, side-by-side comparison, and PDF export.

---

## Existing Infrastructure

### Already Built (Extensive)
| Item | File | Notes |
|------|------|-------|
| Selection type | types/index.ts lines 3181-3207 | budgetAmount, budgetVariance, options[], selectedPrice, status |
| SelectionOption type | types/index.ts lines 3166-3179 | imageURL, supplierName, price, leadTimeDays |
| SelectionStatus | types/index.ts line 3151 | pending, selected, approved, ordered, installed |
| useSelections hook | lib/hooks/useSelections.ts | Full CRUD, approval workflow, budget variance |
| SelectionBoard | components/client-portal/SelectionBoard.tsx | 319 lines, category tabs, compare mode |
| Client selections page | app/client/projects/[id]/selections/page.tsx | 229 lines, option cards, budget variance |

---

## What's Missing

- [ ] **AllowanceTracker** — Budget summary per category (allocated, spent, remaining, over/under)
- [ ] **SelectionComparison** — Enhanced side-by-side with images, full specs, price delta
- [ ] **SelectionPDFExport** — @react-pdf/renderer document with all selections and photos
- [ ] **CategoryGrid** — Visual grid of category cards showing status and budget at a glance

---

## Files to Create

| # | File Path | Purpose | Pattern |
|---|-----------|---------|---------|
| 1 | components/selections/AllowanceTracker.tsx | Budget per category + rollup totals | ProgressDashboard pattern |
| 2 | components/selections/SelectionComparison.tsx | Side-by-side with images + specs | SelectionBoard compare enhanced |
| 3 | components/selections/SelectionPDFExport.tsx | PDF export with photos + pricing | InvoicePDF pattern (dynamic import) |
| 4 | components/selections/CategoryGrid.tsx | Category overview cards | StatsGrid pattern |
| 5 | components/selections/index.ts | Barrel exports | Standard |

## Files to Modify

| # | File Path | What Changes |
|---|-----------|-------------|
| 1 | app/client/projects/[id]/selections/page.tsx | Add AllowanceTracker, CategoryGrid toggle, PDF button |
| 2 | components/client-portal/SelectionBoard.tsx | Enhance compare view, add budget rollup header |

---

## Parallel Work Plan

### Batch 1 (No Dependencies)
| Agent | Task | Est. Tokens |
|-------|------|-------------|
| Agent 1 | AllowanceTracker component | ~15k |
| Agent 2 | CategoryGrid component | ~12k |
| Agent 3 | SelectionComparison component | ~15k |

### Batch 2 (Depends on Batch 1)
| Agent | Task | Est. Tokens |
|-------|------|-------------|
| Agent 1 | SelectionPDFExport (dynamic import @react-pdf) | ~20k |
| Agent 2 | Enhance client selections page with new components | ~20k |

---

## Acceptance Criteria

- [ ] AllowanceTracker shows budget per category with over/under color coding
- [ ] AllowanceTracker shows rollup totals across all categories
- [ ] CategoryGrid displays cards per category with status icon, budget bar, count
- [ ] SelectionComparison shows side-by-side with images, specs, price delta
- [ ] PDF export generates document with all selections, photos, pricing
- [ ] All components mobile-responsive
- [ ] npx tsc --noEmit passes

---

## Estimated Token Budget: ~105-135k
