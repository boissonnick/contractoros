# Sprint 116: Subcontractor Portal & Workflow Enhancement — Implementation Brief

> **Generated:** 2026-02-06
> **Generated By:** Roadmap Planning Session
> **Status:** Ready for Implementation (skip plan mode)
> **Priority:** P2 | **Hours:** 8-10

---

## Overview

Enhance the subcontractor portal with bid submission, invoice management, and compliance document tracking. Subs should be able to self-service their relationship with the GC.

---

## Existing Infrastructure

### Hooks
| Hook | File | Notes |
|------|------|-------|
| useSubcontractors | lib/hooks/useSubcontractors.ts | Sub CRUD, trade categories |
| useBids | lib/hooks/useBids.ts | Bid CRUD, status workflow |
| useSubcontractorInvoices | lib/hooks/useSubcontractorInvoices.ts | Sub invoice management |
| useLienWaivers | lib/hooks/useLienWaivers.ts | Lien waiver tracking |

### Pages
| Route | File | Notes |
|-------|------|-------|
| /sub | app/sub/page.tsx | Sub portal dashboard |
| /sub/bids | app/sub/bids/page.tsx | Bid list for sub |
| /sub/invoices | app/sub/invoices/page.tsx | Sub invoice list |
| /dashboard/subcontractors | app/dashboard/subcontractors/page.tsx | GC sub management |

### Components
| Component | File | Notes |
|-----------|------|-------|
| SubcontractorCard | components/subcontractors/SubcontractorCard.tsx | Sub display card |
| BidCard | components/subcontractors/BidCard.tsx | Bid display card |

---

## What Exists vs What's Missing

### Already Built
- [x] Subcontractor CRUD with trade categories
- [x] Bid submission and status tracking
- [x] Sub invoice management
- [x] Lien waiver tracking
- [x] Sub portal with basic dashboard

### Needs to be Created
- [ ] Sub bid submission form (sub-facing, not GC-facing)
- [ ] Sub invoice upload with OCR integration
- [ ] Compliance document vault (insurance, W-9, licenses)
- [ ] Sub performance scorecard (on-time %, quality rating, etc.)
- [ ] Sub onboarding checklist

### Needs Modification
- [ ] Sub portal dashboard — Add compliance status, active bids, pending invoices
- [ ] useSubcontractors.ts — Add compliance tracking, performance metrics
- [ ] SubcontractorCard.tsx — Show compliance badges, performance rating

---

## Files to Create

| # | File Path | Purpose | Pattern to Follow |
|---|-----------|---------|-------------------|
| 1 | components/sub-portal/BidSubmissionForm.tsx | Sub-facing bid form | FormModal pattern |
| 2 | components/sub-portal/InvoiceUpload.tsx | Invoice upload with OCR | Photo upload pattern |
| 3 | components/sub-portal/ComplianceVault.tsx | Document management | Documents pattern |
| 4 | components/sub-portal/PerformanceScorecard.tsx | Sub metrics dashboard | StatsGrid pattern |
| 5 | components/sub-portal/OnboardingChecklist.tsx | Sub onboarding steps | Checklist pattern |
| 6 | lib/hooks/useSubCompliance.ts | Compliance doc tracking | useDocuments pattern |
| 7 | lib/hooks/useSubPerformance.ts | Performance metrics | useCompanyStats pattern |
| 8 | app/sub/compliance/page.tsx | Sub compliance docs page | Standard page |
| 9 | app/sub/onboarding/page.tsx | Sub onboarding flow | Step wizard |

## Files to Modify

| # | File Path | What Changes |
|---|-----------|-------------|
| 1 | types/index.ts | Add ComplianceDoc, SubPerformance, OnboardingStep types |
| 2 | app/sub/page.tsx | Enhanced dashboard with compliance + performance widgets |
| 3 | components/subcontractors/SubcontractorCard.tsx | Compliance badges, rating |

---

## Parallel Work Plan

### Batch 1 (No Dependencies)
| Agent | Task | Files | Est. Tokens |
|-------|------|-------|-------------|
| Agent 1 | Bid submission + invoice upload | BidSubmissionForm.tsx, InvoiceUpload.tsx | ~25k |
| Agent 2 | Compliance vault + hook | ComplianceVault.tsx, useSubCompliance.ts | ~25k |
| Agent 3 | Performance scorecard + onboarding | PerformanceScorecard.tsx, OnboardingChecklist.tsx, useSubPerformance.ts | ~25k |

### Batch 2 (Integration)
| Agent | Task | Files | Est. Tokens |
|-------|------|-------|-------------|
| Agent 4 | Wire into sub portal, add pages, Firestore rules | sub/ pages, firestore.rules | ~20k |

---

## Acceptance Criteria

- [ ] Subs can submit bids through their portal
- [ ] Subs can upload invoices with OCR capture
- [ ] Compliance vault tracks insurance, W-9, licenses with expiry
- [ ] Performance scorecard shows on-time %, quality rating
- [ ] Onboarding checklist guides new subs through setup
- [ ] npx tsc --noEmit passes

---

## Estimated Token Budget: ~95k
