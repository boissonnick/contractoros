# Sprint [N]: [Name] — Implementation Brief

> **Generated:** [Date]
> **Generated By:** Scoping Sprint [N-1]
> **Spec:** `docs/specs/EPIC-XX-NAME.md`
> **Status:** Ready for Implementation (skip plan mode)

---

## Existing Infrastructure

Files already in the codebase that this sprint touches or builds on:

### Types
| Type/Interface | File | Lines | Notes |
|---------------|------|-------|-------|
| ExampleType | types/index.ts | 100-150 | Already has required fields |

### Hooks
| Hook | File | Pattern | Notes |
|------|------|---------|-------|
| useExample | lib/hooks/useExample.ts | CRUD + real-time | Existing, needs extension |

### Pages
| Route | File | Notes |
|-------|------|-------|
| /dashboard/example | app/dashboard/example/page.tsx | Existing page, add tab |

### Components
| Component | File | Notes |
|-----------|------|-------|
| ExampleCard | components/example/ExampleCard.tsx | Reusable pattern |

### Cloud Functions
| Function | File | Trigger | Notes |
|----------|------|---------|-------|
| (none yet) | - | - | Need to create |

### Firestore Collections
| Collection | Path | Indexes | Notes |
|------------|------|---------|-------|
| example | organizations/{orgId}/example | field1+field2 | Existing |

---

## What Exists vs What's Missing

### Already Built
- [ ] Item 1 — file path and what it does
- [ ] Item 2

### Needs to be Created
- [ ] Item 1 — what it is and why
- [ ] Item 2

### Needs Modification
- [ ] Item 1 — what changes and why
- [ ] Item 2

---

## Files to Create

| # | File Path | Purpose | Pattern to Follow |
|---|-----------|---------|-------------------|
| 1 | path/to/new/file.ts | Description | See similar/file.ts |
| 2 | path/to/new/file.tsx | Description | See similar/component.tsx |

## Files to Modify

| # | File Path | What Changes | Lines Affected |
|---|-----------|-------------|----------------|
| 1 | path/to/existing.ts | Add new interface | After line ~150 |
| 2 | path/to/existing.tsx | Add new tab/section | Lines 200-250 |

---

## Patterns to Follow

### Hook Pattern
```
Reference: lib/hooks/useExpenses.ts
- Uses onSnapshot for real-time
- Returns {items, loading, error}
- Early return if !orgId
```

### Component Pattern
```
Reference: components/expenses/ExpenseCard.tsx
- Card layout with status badge
- Uses PageHeader for title
- Mobile-responsive grid
```

### Cloud Function Pattern
```
Reference: functions/src/index.ts
- Gen 2 Cloud Functions
- Uses named database: getFirestore(app, 'contractoros')
- Exports from index.ts
```

---

## Firestore Rules Needed

```javascript
// Add to firestore.rules:
match /organizations/{orgId}/newCollection/{docId} {
  allow read, write: if isSameOrg(orgId);
}
```

## Firestore Indexes Needed

```json
{
  "collectionGroup": "newCollection",
  "queryScope": "COLLECTION",
  "fields": [
    { "fieldPath": "field1", "order": "ASCENDING" },
    { "fieldPath": "field2", "order": "DESCENDING" }
  ]
}
```

---

## Parallel Work Plan

Tasks that can be developed simultaneously by sub-agents:

### Batch 1 (No Dependencies)
| Agent | Task | Files | Est. Tokens |
|-------|------|-------|-------------|
| Feature Agent 1 | Build types + hook | types/index.ts, lib/hooks/useX.ts | ~20k |
| Feature Agent 2 | Build UI component | components/x/Card.tsx | ~15k |
| Database Agent | Add rules + indexes | firestore.rules, firestore.indexes.json | ~10k |

### Batch 2 (Depends on Batch 1)
| Agent | Task | Files | Est. Tokens |
|-------|------|-------|-------------|
| Feature Agent | Build page integrating hook + component | app/dashboard/x/page.tsx | ~25k |
| Cloud Function Agent | Build aggregation function | functions/src/x.ts | ~20k |

### Batch 3 (Integration)
| Agent | Task | Files | Est. Tokens |
|-------|------|-------|-------------|
| Integration Agent | Wire everything together, test | Multiple | ~15k |

---

## Acceptance Criteria (from spec)

- [ ] Criterion 1
- [ ] Criterion 2
- [ ] Criterion 3

---

## Decision Log

Decisions made during scoping that affect implementation:

| Decision | Rationale | Alternative Considered |
|----------|-----------|----------------------|
| Use X approach | Because Y | Z was too complex for MVP |

---

## Estimated Token Budget

| Phase | Tokens | Notes |
|-------|--------|-------|
| Reading this brief | ~5k | Replaces 150-200k Explore |
| Implementation | ~100-150k | Actual coding |
| Testing + fixes | ~30-50k | TypeScript check, integration |
| **Total** | **~135-205k** | **vs ~300-400k without brief** |
