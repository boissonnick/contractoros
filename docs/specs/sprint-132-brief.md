# Sprint 132: AI Assistant Chat Enhancement — Implementation Brief

> **Generated:** 2026-02-06
> **Generated By:** Roadmap Planning Session (Phase 20: AI & Intelligence)
> **Status:** Ready for Implementation (skip plan mode)
> **Priority:** P2 | **Hours:** 8-10
> **Depends On:** Sprints 129-131 (AI context)

---

## Overview

Enhance the existing AI assistant with contextual project knowledge and actionable capabilities. The assistant knows current project state, can create tasks, answer data questions, and generate documents from natural language.

---

## Existing Infrastructure

| File | Purpose | Notes |
|------|---------|-------|
| lib/assistant/server-context-loader.ts | Server-side data loading for AI | Loads org context |
| app/api/assistant/route.ts | AI chat API route | Auth, rate limiting, model routing |
| components/ai/AIAssistantPanel.tsx | Chat panel UI | Existing component |
| lib/ai/prompts.ts | Prompt templates | NL_QUERY_PARSE_PROMPT exists |

---

## Files to Create

| # | File Path | Purpose | Pattern |
|---|-----------|---------|---------|
| 1 | lib/ai/assistant-context.ts | Build project/financial context for AI | server-context-loader |
| 2 | lib/ai/assistant-actions.ts | Execute actions from AI (create task, query data) | New pattern |
| 3 | lib/ai/document-generator.ts | Generate change orders, SOWs from natural language | estimate-generator |
| 4 | app/api/ai/assistant-action/route.ts | Execute AI-suggested actions | API route |

## Files to Modify

| # | File Path | What Changes |
|---|-----------|-------------|
| 1 | app/api/assistant/route.ts | Add context injection, action detection |
| 2 | components/ai/AIAssistantPanel.tsx | Add action confirmation UI, voice input |
| 3 | lib/assistant/server-context-loader.ts | Expand context (projects, invoices, budget) |

---

## Capabilities

### Contextual Queries
- "What's the margin on the Johnson kitchen project?" → Pulls real financial data
- "Show me all overdue invoices over $5,000" → Filters and displays results

### Actionable Commands
- "Create a task for electrician rough-in next Tuesday" → Creates task
- "Draft a change order for the added bathroom" → Generates CO document

### Document Generation
- Change orders, scope of work, meeting notes from natural language

---

## Parallel Work Plan

### Batch 1
| Agent | Task | Est. Tokens |
|-------|------|-------------|
| Agent 1 | Context builder (project, financial, schedule data) | ~25k |
| Agent 2 | Action executor (create task, query data) | ~25k |
| Agent 3 | Document generator (change orders, SOW) | ~20k |

### Batch 2
| Agent | Task | Est. Tokens |
|-------|------|-------------|
| Agent 4 | Enhance assistant route + panel UI | ~25k |

---

## Acceptance Criteria

- [ ] AI can answer questions about projects with real data
- [ ] "Create a task..." actually creates the task (with user confirmation)
- [ ] "Show me overdue invoices..." returns filtered real data
- [ ] Document generation produces draft change orders
- [ ] npx tsc --noEmit passes

---

## Estimated Token Budget: ~95k
