# Sprint 129: AI Estimate Builder — Implementation Brief

> **Generated:** 2026-02-06
> **Generated By:** Roadmap Planning Session (Phase 20: AI & Intelligence)
> **Status:** Ready for Implementation (skip plan mode)
> **Priority:** P0 | **Hours:** 10-14

---

## Overview

AI generates full estimates from natural language project descriptions. Users provide project description, square footage, project type, and ZIP code. AI produces 20-40 line items with quantities, unit prices, and labor hours using existing FRED/BLS cost data and the configured AI model. This is the killer feature for residential GCs.

---

## Existing Infrastructure

### AI Infrastructure
| File | Purpose | Notes |
|------|---------|-------|
| lib/ai/prompts.ts | Centralized AI prompts | Has ESTIMATE_REVIEW_PROMPT |
| lib/ai/estimate-analyzer.ts | Rule-based analysis | PROJECT_TYPE_ITEMS, PRICE_BENCHMARKS |
| lib/assistant/models/ | Multi-model router | ModelRouter.chat() — Claude, Gemini, OpenAI |
| app/api/assistant/route.ts | Main AI API route | Auth, rate limiting, model routing |

### Cost Data (Already Populated by Cloud Functions)
| Collection | Source | Data |
|------------|--------|------|
| intelligence_materials | FRED API | Lumber, steel, cement, copper, concrete, gypsum, insulation prices |
| intelligence_labor | BLS OEWS API | 13 trades with state-level hourly rates |

### Estimate Types & Hooks
| Item | File | Notes |
|------|------|-------|
| Estimate type | types/index.ts lines 2460-2535 | Full estimate with lineItems, sections |
| EstimateLineItem | types/index.ts lines 2546-2600 | quantity, unitCost, materialCost, laborCost, trade |
| useEstimates | lib/hooks/useEstimates.ts | createEstimate, calculateEstimateTotals |
| Estimate new page | app/dashboard/estimates/new/page.tsx | Target for AI integration |

---

## Files to Create

| # | File Path | Purpose | Pattern |
|---|-----------|---------|---------|
| 1 | app/api/ai/generate-estimate/route.ts | API route: project description → AI line items | app/api/assistant/route.ts |
| 2 | lib/ai/estimate-generator.ts | Prompt engineering + response parsing | lib/ai/prompts.ts |
| 3 | lib/ai/cost-data.ts | Load FRED/BLS data, regional adjustments | Pure utility |
| 4 | components/estimates/AIEstimateBuilder.tsx | Multi-step wizard UI | QuickEstimateBuilder |
| 5 | components/estimates/AILineItemReview.tsx | Review/edit/accept each AI line item | EstimateLineItemRow |
| 6 | components/estimates/AIEstimateProgress.tsx | Progress during generation | Simple component |

## Files to Modify

| # | File Path | What Changes |
|---|-----------|-------------|
| 1 | app/dashboard/estimates/new/page.tsx | Add "Generate with AI" option |
| 2 | types/index.ts | Add AIEstimateRequest, AIEstimateResponse types |

---

## Key Design Decisions

| Decision | Rationale |
|----------|-----------|
| Use existing ModelRouter | Supports user's configured provider (Claude, Gemini, OpenAI) |
| Load cost data server-side | Keeps FRED/BLS data secure, simpler auth |
| JSON structured output from AI | Reliable parsing, consistent schema |
| temperature: 0.3 | More consistent, reproducible pricing |
| Regional multipliers as static lookup | Simple, accurate enough for MVP |
| Confidence score per line item | Lets user know which items need review |

---

## Parallel Work Plan

### Batch 1 (No Dependencies)
| Agent | Task | Est. Tokens |
|-------|------|-------------|
| Agent 1 | Types + cost-data loader (regional multipliers, ZIP→state) | ~15k |
| Agent 2 | Estimate-generator prompt engine + response parser | ~25k |
| Agent 3 | UI components (AIEstimateBuilder, AILineItemReview, AIEstimateProgress) | ~30k |

### Batch 2 (Depends on Batch 1)
| Agent | Task | Est. Tokens |
|-------|------|-------------|
| Agent 1 | API route wiring generator + cost-data + model router | ~25k |
| Agent 2 | Integrate into estimates/new page | ~15k |

### Batch 3 (Integration)
| Agent | Task | Est. Tokens |
|-------|------|-------------|
| Agent 1 | End-to-end test, TypeScript check | ~20k |

---

## Acceptance Criteria

- [ ] User enters "2,500 sq ft kitchen remodel in Portland, OR" → AI generates 20-40 line items
- [ ] Prices reference FRED material indices and BLS labor rates
- [ ] Regional adjustments applied based on ZIP/state
- [ ] User can review each line item: accept, edit, reject
- [ ] Accept all creates draft estimate via existing createEstimate()
- [ ] Each line item has confidence score (0.0-1.0)
- [ ] Works with any configured AI provider via ModelRouter
- [ ] npx tsc --noEmit passes

---

## Estimated Token Budget: ~135k
